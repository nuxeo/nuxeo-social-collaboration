<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Public Social Workspaces"
    description="Gives the possibility to find public Social Workspaces"
    author="Benjamin JALON" author_email="bjalon@nuxeo.com" height="280">

    <Require feature="jquery" />
    <Require feature="nuxeo" />
    <Require feature="setprefs"/>
    <#include "dynamic-translations.ftl"/>
    <Require feature="dynamic-height" />
    <#include "default-oauth-prefs.ftl"/>
  </ModulePrefs>
  <#include "context-prefs.ftl"/>
  <Content type="html">

<![CDATA[
<html>
  <head>
  <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}gadget-common.css"/>
  <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}documentlists.css"/>
  <link rel="stylesheet" type="text/css" href="publicsocialworkspaces.css"/>

  <!-- insert JS Context -->
  ${jsContext}

  <script src="${specDirectoryUrl}default-automation-request.js"></script>
  <script src="${specDirectoryUrl}context-management.js"></script>
  <script src="${specDirectoryUrl}default-documentlist-display.js"></script>
  <script src="${specDirectoryUrl}dashboard-navigation.js"></script>

  <script>
var prefs = new gadgets.Prefs();

function getPublicSociaWorkspaces() {
  var pattern = jQuery('#queryText').val();

  var NXRequestParams = { operationId:  'SocialWorkspace.GetPublicSocialWorkspaces',
    operationParams: { pattern: pattern },
      operationContext: {},
      operationDocumentProperties: "common,dublincore",
      entityType: 'documents',
      usePagination: true,
      displayMethod: displayDocumentList,
      displayColumns: [
        {type: 'builtin', field: 'icon'},
        {type: 'builtin', field: 'titleWithLink', label: '__MSG_label.dublincore.title__', view: 'social_dashboard', codec: 'collaboration'},
        {type: 'date', field: 'dc:modified', label: '__MSG_label.dublincore.modified__'},
        {type: 'text', field: 'dc:creator', label: '__MSG_label.dublincore.creator__'}
    ],
    noEntryLabel: '__MSG_label.info.no.social.workspace.found__' };

    doAutomationRequest(NXRequestParams);
}

function displaySearchForm() {
  var searchFormHtml = '<div class="wideDefinition">';
  searchFormHtml += '<input class="searchBox" name="queryText" id="queryText" type="text"></input>';
  searchFormHtml += '<a href="javascript:getPublicSociaWorkspaces()">' + prefs.getMsg('command.search') + '</a>';
  searchFormHtml += '<div class="clear"></div>';
  searchFormHtml += '</div>';

  jQuery('#search').html(searchFormHtml);
  jQuery('#queryText').keydown(function(event) {
    if (event.keyCode == '13') {
      getPublicSociaWorkspaces();
    }
  });
}

gadgets.util.registerOnLoadHandler(function() {displaySearchForm(); getPublicSociaWorkspaces();} );

</script>


 </head>
 <body>
   <div class="tools">
     <div id="search"></div>
     <#include "context-chooser-ui.ftl"/>
   </div>
   <div id="content">
     <#include "default-documentlist-layout.ftl"/>
     <#include "default-request-controls.ftl"/>
   </div>
  </body>
</html>
]]>
  </Content>
</Module>
