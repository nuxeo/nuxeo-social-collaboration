<f:subview xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:h="http://java.sun.com/jsf/html"
  id="#{widget.id}">

  <c:set var="cssClass" value="miniMessage #{nxu:test(currentUser.name == field.actor, 'owner', '')}" />
  <div class="#{cssClass}">
    <div>
      <span class="username"><h:outputText value="#{field.displayActor}" escape="false"/></span>
      <span class="timestamp">#{nxu:formatDateUsingBasicFormatter(field.publishedDate)}</span>
    </div>

    <div class="message">
      <h:outputText value="#{field.message}" escape="false"/>
    </div>

    <c:if test="#{currentUser.name == field.actor}">
      <script type="text/javascript">
        function confirmDeleteMiniMessage() {
          return confirm("#{messages['label.mini.message.confirmDelete']}");
        }
        </script>

      <div class="deleteMiniMessage">
        <a4j:commandLink action="#{miniMessageActions.deleteMiniMessage(field)}"
          reRender="miniMessagesPanel,facesStatusMessagePanel"
          onclick="if (!confirmDeleteMiniMessage()) { return false; }">
          <h:outputText value="#{messages['command.delete']}" />
        </a4j:commandLink>
      </div>
    </c:if>
  </div>

</f:subview>
